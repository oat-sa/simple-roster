openapi: 3.0.0
info:
  title: TAO Simple Roaster API
  description: '' # TODO
  version: 1.0.0

servers:
- url: https://example.com/api/v1 # TODO

paths:
  /auth/login:
    post:
      summary: Login the user
      tags:
      - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                password:
                  type: string
      responses:
        200:
          description: The user logged in successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                    description: JWT access token
                  refreshToken:
                    type: string
                    description: JWT refresh token

        400:
          $ref: '#/components/responses/BadRequestResponse'
        403:
          $ref: '#/components/responses/InvalidCredentialsResponse'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'

  /auth/token:
    post:
      summary: Request new token
      tags:
      - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
                  description: JWT refresh token
      responses:
        200:
          description: New token requested successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                    description: New JWT access token
                  refreshToken:
                    type: string
                    description: New JWT refresh token
        400:
          $ref: '#/components/responses/BadRequestResponse'
        401:
          $ref: '#/components/responses/UnauthorizedResponse'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'
  /auth/logout:
    post:
      summary: Logout the user
      tags:
      - Authentication
      parameters:
      - name: accessToken
        in: query
        description: JWT access token
        required: true
        schema:
          type: string
      responses:
        204:
          description: The user logged out successfully
        401:
          $ref: '#/components/responses/UnauthorizedResponse'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'

  /assignments:
    get:
      summary: Returns the assignments for the current user
      description: Returns all the assignments which belongs to the currently logged in user.
      tags:
      - Assignments
      parameters:
      - name: accessToken
        in: query
        description: JWT access token
        required: true
        schema:
          type: string
      - name: page
        in: query
        description: Number of page
        schema:
          type: integer
          default: 1
      - name: limit
        in: query
        description: Number of assignments to return per page
        schema:
          type: integer
          default: 25 #TODO
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  _links:
                    type: object
                    properties:
                      self:
                        type: object
                        properties:
                          href:
                            type: string
                            example: /api/v1/assignments?page=2
                      first:
                        type: object
                        properties:
                          href:
                            type: string
                            example: /api/v1/assignments?page=1
                      prev:
                        type: object
                        properties:
                          href:
                            type: string
                            example: /api/v1/assignments?page=1
                      next:
                        type: object
                        properties:
                          href:
                            type: string
                            example: /api/v1/assignments?page=3
                      last:
                        type: object
                        properties:
                          href:
                            type: string
                            example: /api/v1/assignments?page=12
                  count:
                    type: integer
                    example: 3
                  total:
                    type: integer
                    example: 36
                  _embedded:
                    type: object
                    properties:
                      assignments:
                        type: array
                        items:
                          $ref: '#/components/schemas/Assignment'
        400:
          $ref: '#/components/responses/BadRequestResponse'
        401:
          $ref: '#/components/responses/UnauthorizedResponse'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'
    post:
      summary: Creates a new assignment for the current user
      tags:
      - Assignments
      parameters:
      - name: accessToken
        in: query
        description: JWT access token
        required: true
        schema:
          type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                lineItemId:
                  type: string
      responses:
        201:
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    description: The ID of the created Assignment
                    example: 13
        400:
          $ref: '#/components/responses/BadRequestResponse'
        401:
          $ref: '#/components/responses/UnauthorizedResponse'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'


  /assignments/{id}/lti-link:
    get:
      summary: Returns the LTI link for the given assignment
      description: lorem ipsum dolor
      tags:
      - Assignments
      parameters:
      - name: accessToken
        in: query
        description: JWT access token
        required: true
        schema:
          type: string
      - name: id
        in: path
        description: The ID of the assignment
        required: true
        schema:
          type: integer
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  ltiLink:
                    type: string
                    description: The url for the LTI resource
                    example: https://lti.example.com/something # TODO
        401:
          $ref: '#/components/responses/UnauthorizedResponse'
        404:
          $ref: '#/components/responses/AssignmentNotFoundResponse'
        500:
          $ref: '#/components/responses/InternalServerErrorResponse'

components:
  schemas:
    Assignment:
      type: object
      properties:
        id:
          type: integer
          description: The assignment ID
          example: 13
        username:
          type: string
          description: The username of the user who belongs to the assignment
          example: johndoe
        lineItem:
          $ref: '#/components/schemas/LineItem'
    LineItem:
      type: object
      properties:
        uri:
          type: string
          example: my-tao-instance.com/tao.rdf#123456789 # TODO
        login:
          type: string
          example: johndoe
        name:
          type: string
          example: Delivery#12
        startDateTime:
          type: integer
          description: The start DateTime in UNIX timestamp
          example: 1542880258
        endDateTime:
          type: integer
          description: The end DateTime in UNIX timestamp
          example: 1542880258
        infrastructure:
          type: integer
          description: The infrastructure ID
          example: 2
    Error:
      type: object
      description: Problem details object (RFC7807)
      properties:
        type:
          type: string
          description: A URI reference that identifies the problem type.
          example: https://example.com/api/probs/out-of-credit
        title:
          type: string
          description: A short, human-readable summary of the problem type.
          example: You do not have enough credit.
        status:
          type: integer
          description: The HTTP status code, generated by the origin server for this occurrence of the problem.
          enum:
          - 400
          - 401
          - 403
          - 404
          - 500
          example: 403
        detail:
          type: string
          description: A human-readable explanation specific to this occurrence of the problem.
          example: Your current balance is 30, but that costs 50.
        instance:
          type: string
          description: A URI reference that identifies the speciic occurrence of the problem.
          example: /account/12345/msgs/abc
  responses:
    BadRequestResponse:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    UnauthorizedResponse:
      description: Unauthorized
      headers:
        WWW-Authenticate:
          schema:
            type: string
            description: Authentication method that should be used to gain access to a resource.
            example: Bearer
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    InvalidCredentialsResponse:
      description: Invalid credentials
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    AssignmentNotFoundResponse:
      description: Assignment not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    InternalServerErrorResponse:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
