# Development in local environment

> Purpose of this document is to describe how to set up and use the application in local environment

## Table of contents

- [Installation](#installation)
- [Testing](#testing)

## Installation

First you have to create a local copy of the `.env.dist` file:

```bash
$ cp .env.dist .env
```

then to define the environment variables according to your local environment, such as redis DNS, database url, etc. 
To see the full list of available environment variables please refer to the [devops documentation](devops-documentation.md).

The application uses JWT tokens for API authentication. You must generate your private/public keypair to make it work.

To generate private key:

```shell script
$ openssl genpkey -out config/secrets/dev/jwt_private.pem -aes256 -algorithm rsa -pkeyopt rsa_keygen_bits:4096
```

Make sure you update the `JWT_PASSPHRASE` environment variable in your `.env.local` file with the passphrase of your choice.

To generate public key:

```shell script
$ openssl pkey -in config/secrets/dev/jwt_private.pem -out config/secrets/dev/jwt_public.pem -pubout
```

To run the application with Symfony's built-in web-server just launch:

```shell script
 $ bin/console server:start
```

**Note:** If you want to run the application using your own web-server, please refer to Symfony's official [documentation](https://symfony.com/doc/current/setup/web_server_configuration.html) about web server configuration.

To install dependencies run:

```shell script
$ composer install
```

## Testing

### PHPUnit

To run the full test suite execute:

```shell script
$ bin/phpunit
```

If you receive an error message about not finding the bootstrap files:

__(bin/.phpunit/phpunit-8.3-0/vendor/composer/../symfony/phpunit-bridge/bootstrap.php): failed to open stream: No such file or directory ...)__

try to delete the autogenerated phpunit folder:

```shell script
$ rm -rf bin/.phpunit
```

and execute the command again.

### Infection

To run infection suite execute:

```shell script
$ vendor/bin/infection --threads=$(nproc)
```

If you receive an error message about not finding the bootstrap files:

__(bin/.phpunit/phpunit-8.3-0/vendor/composer/../symfony/phpunit-bridge/bootstrap.php): failed to open stream: No such file or directory ...)__

try to delete the autogenerated phpunit folder:

```shell script
$ rm -rf bin/.phpunit
```

and execute the command again.
